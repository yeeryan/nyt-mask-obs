---
title: "Mask Observations Report"
author: "Ryan Yee"
date: "11/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggfortify)
library(plotly)
library(dplyr)

setwd("~/Projects/nyt-mask-obs/")

#source("R/import.R")
source("setup.R")
source("R/unified_plot.R")


#Merge NYC Health Data and NYT Mask Observations
nyc.covid19.mask <- inner_join(nyc.covid19.data, nyt.data, by="zip")

#Filter Data Function
date_covid19.mask <- function(day) {
  nyc.covid19.mask %>% filter(date == day)
}

```


```{r Map, echo=FALSE, results='HIDE', warning=FALSE}
unified.plot
```

```{r COVID19 Case Rate Graph, echo=FALSE, results='HIDE', warning=FALSE}
plot_ly(nyc.covid19.mask,
        x = ~date,
        y = ~COVID_CASE_RATE,
        color = ~area,
        mode = 'lines+markers'
)

```

```{r COVID19 Mask Observations, echo=FALSE, results='HIDE', warning=FALSE}
plot_ly(nyt.data,
        x = ~area,
        y = ~obs_mask,
        color = ~area,
        mode = 'bar'
)
```




```{r July 13 Analysis - Linear Models}
data_0713 <- as.data.frame(date_covid19.mask("2020-07-13"))

mask.data_0713 <- lm(COVID_CASE_RATE ~ obs_mask + PERCENT_POSITIVE + POP_DENOMINATOR, data_0713)

nomask.data_0713 <- lm(COVID_CASE_RATE ~ PERCENT_POSITIVE + POP_DENOMINATOR, data_0713)
  
summary(mask.data_0713)
summary(nomask.data_0713)
```

```{r July 13 Analysis - ANOVA}
anova(mask.data_0713, nomask.data_0713)

```


```{r July 13 Analysis - Confidence Intervals}
confint(mask.data_0713)

confint(nomask.data_0713)
```

```{r July 13 Analysis - Diagnostic Plots}
autoplot(mask.data_0713)

autoplot(nomask.data_0713)

```